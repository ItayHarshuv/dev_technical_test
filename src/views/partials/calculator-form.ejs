<% 
    // Set defaults for context (desktop or modal)
    // context is passed from the include statement
    const formContext = context ?? 'desktop';
    const isDesktop = formContext === 'desktop';
    const isModal = formContext === 'modal';
    
    // Set IDs based on context
    const idPostfix = isDesktop ? '' : 'Modal';

    const formId = isDesktop ? 'calculatorForm' : 'calculatorFormModal';
    const purchasePriceId = `purchasePrice${idPostfix}`;
    const monthlyRentId = `monthlyRent${idPostfix}`;
    const annualFeeId = `annualFee${idPostfix}`;
    const emailId = `email${idPostfix}`;
    const dataDrivenToggleId = `dataDrivenToggle${idPostfix}`;
    const dataDrivenFieldsId = `dataDrivenFields${idPostfix}`;
    const surfaceId = `surface${idPostfix}`;
    const bedroomsId = `bedrooms${idPostfix}`;
    const locationScoreId = `locationScore${idPostfix}`;
    
    // Set classes based on context
    const formClasses = isDesktop ? 'd-none d-lg-flex flex-column align-items-center gap-0 mt-4 w-100 calculator-form-desktop' : '';
    const fieldWrapperClass = isDesktop ? 'search-field-section flex-fill d-flex flex-column justify-content-center' : 'mb-3';
    const labelClass = isDesktop ? 'search-field-label text-uppercase mb-2' : 'form-label';
    const inputClass = isDesktop ? 'search-field-input' : 'form-control';
    const fieldsContainerClass = isDesktop ? 'search-box-container bg-white rounded d-flex flex-column flex-fill w-100' : '';
    const dataDrivenFieldsClass = isDesktop ? 'd-none d-flex align-items-end gap-3 mt-2' : 'd-none';
    const toggleButtonClass = isDesktop ? 'btn btn-outline-secondary btn-sm' : 'btn btn-outline-secondary';
    const toggleWrapperClass = isDesktop ? 'd-flex justify-content-center mt-2' : 'mb-3 d-flex justify-content-center';
    const submitWrapperClass = isDesktop ? '' : 'd-grid';
    
    // Set label text based on context
    const purchasePriceLabel = isDesktop ? 'Purchase Price' : 'Purchase Price of the Property';
    const monthlyRentLabel = isDesktop ? 'Monthly Rent' : 'Monthly Rent Amount';
    const annualFeeLabel = isDesktop ? 'Annual Fee' : 'Annual Rental Fee';
    const emailLabel = isDesktop ? 'Email Address' : 'Prospect\'s Email Address';
%>

<form class="<%= formClasses %>" id="<%= formId %>">
    <% if (isDesktop) { %>
        <div class="d-flex align-items-stretch w-100 gap-0">
            <div class="<%= fieldsContainerClass %>" id="<%= isDesktop ? 'searchBoxContainerDesktop' : '' %>">
                <div class="d-flex align-items-stretch w-100">
                    <div class="<%= fieldWrapperClass %>">
                        <label for="<%= purchasePriceId %>" class="<%= labelClass %>"><%= purchasePriceLabel %></label>
                        <input type="number" class="<%= inputClass %>" id="<%= purchasePriceId %>" name="purchasePrice" placeholder="Enter price" required>
                    </div>
                    
                    <div class="search-field-divider"></div>
                    
                    <div class="<%= fieldWrapperClass %>">
                        <label for="<%= monthlyRentId %>" class="<%= labelClass %>"><%= monthlyRentLabel %></label>
                        <input type="number" class="<%= inputClass %>" id="<%= monthlyRentId %>" name="monthlyRent" placeholder="Enter amount" required>
                    </div>
                    
                    <div class="search-field-divider"></div>
                    
                    <div class="<%= fieldWrapperClass %>">
                        <label for="<%= annualFeeId %>" class="<%= labelClass %>"><%= annualFeeLabel %></label>
                        <input type="number" class="<%= inputClass %>" id="<%= annualFeeId %>" name="annualFee" placeholder="Enter fee" required>
                    </div>
                    
                    <div class="search-field-divider"></div>
                    
                    <div class="<%= fieldWrapperClass %>">
                        <label for="<%= emailId %>" class="<%= labelClass %>"><%= emailLabel %></label>
                        <input type="email" class="<%= inputClass %>" id="<%= emailId %>" name="email" placeholder="Enter email" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary text-uppercase search-button-inline calculate-button">CALCULATE</button>
                </div>
                
                <div id="<%= dataDrivenFieldsId %>" class="<%= isDesktop ? 'd-none d-flex flex-row align-items-start data-driven-fields-container' : 'd-none' %>">
                    <div class="data-driven-field flex-fill d-flex flex-column">
                        <label for="<%= surfaceId %>" class="<%= labelClass %>">Surface (m²)</label>
                        <input type="number" class="form-control" id="<%= surfaceId %>" name="surface" placeholder="20-120" min="20" max="120" step="0.01">
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="data-driven-field flex-fill d-flex flex-column">
                        <label for="<%= bedroomsId %>" class="<%= labelClass %>">Number of Bedrooms</label>
                        <select class="form-select" id="<%= bedroomsId %>" name="bedrooms">
                            <option value="">Select bedrooms</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="data-driven-field flex-fill d-flex flex-column">
                        <label for="<%= locationScoreId %>" class="<%= labelClass %>">Location Score</label>
                        <input type="number" class="form-control" id="<%= locationScoreId %>" name="locationScore" placeholder="5.0-10.0" min="5" max="10" step="0.1">
                        <div class="invalid-feedback"></div>
                    </div>
                </div>
            </div>
        </div>
        <%- include('_advance-button', {
            toggleWrapperClass: toggleWrapperClass,
            toggleButtonClass: toggleButtonClass,
            dataDrivenToggleId: dataDrivenToggleId,
            wrapperId: isDesktop ? 'toggleWrapperDesktop' : ''
        }) %>
    <% } else { %>
        <div class="<%= fieldWrapperClass %>">
            <label for="<%= purchasePriceId %>" class="<%= labelClass %>"><%= purchasePriceLabel %></label>
            <input type="number" class="form-control" id="<%= purchasePriceId %>" name="purchasePrice" placeholder="" required>
        </div>
        
        <div class="<%= fieldWrapperClass %>">
            <label for="<%= monthlyRentId %>" class="<%= labelClass %>"><%= monthlyRentLabel %></label>
            <input type="number" class="form-control" id="<%= monthlyRentId %>" name="monthlyRent" placeholder="" required>
        </div>
        
        <div class="<%= fieldWrapperClass %>">
            <label for="<%= annualFeeId %>" class="<%= labelClass %>"><%= annualFeeLabel %></label>
            <input type="number" class="form-control" id="<%= annualFeeId %>" name="annualFee" placeholder="" required>
        </div>
        
        <div class="<%= fieldWrapperClass %>">
            <label for="<%= emailId %>" class="<%= labelClass %>"><%= emailLabel %></label>
            <input type="email" class="form-control" id="<%= emailId %>" name="email" placeholder="" required>
        </div>
    <% } %>
    
    <% if (!isDesktop) { %>
        <%- include('_advance-button', {
            toggleWrapperClass: toggleWrapperClass,
            toggleButtonClass: toggleButtonClass,
            dataDrivenToggleId: dataDrivenToggleId
        }) %>
        
        <div id="<%= dataDrivenFieldsId %>" class="<%= dataDrivenFieldsClass %>">
            <div class="mb-3">
                <label for="<%= surfaceId %>" class="<%= labelClass %>">Surface (m²)</label>
                <input type="number" class="form-control" id="<%= surfaceId %>" name="surface" placeholder="20-120" min="20" max="120" step="0.01">
                <div class="invalid-feedback"></div>
            </div>
            
            <div class="mb-3">
                <label for="<%= bedroomsId %>" class="<%= labelClass %>">Number of Bedrooms</label>
                <select class="form-select" id="<%= bedroomsId %>" name="bedrooms">
                    <option value="">Select bedrooms</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
                <div class="invalid-feedback"></div>
            </div>
            
            <div class="mb-3">
                <label for="<%= locationScoreId %>" class="<%= labelClass %>">Location Score</label>
                <input type="number" class="form-control" id="<%= locationScoreId %>" name="locationScore" placeholder="5.0-10.0" min="5" max="10" step="0.1">
                <div class="invalid-feedback"></div>
            </div>
        </div>
    <% } %>
    
    <% if (isModal) { %>
        <div class="<%= submitWrapperClass %>">
            <button type="submit" class="btn btn-primary px-5 py-3 text-uppercase calculate-button">CALCULATE</button>
        </div>
    <% } %>
</form>

